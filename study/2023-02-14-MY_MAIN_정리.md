# Intro..

**이 md 파일에선 `my_main.js` 를 제일 중점으로 MY 파트 코드들 정리**

* 뷰 관련 `MyLoginInfoView, FunctionListView` 로 구성
* 기능 관련 `stuinfo_main` 로 구성

**우선, DSIS 깃 개인 브랜치에서 MY 파트 코드들 클론 코딩 하고 난 이후 md 파일 작성하곘음**

* 따라서 자세한 코드 설명은 해당 bonghun/study2 브랜치를 확인



**미리보기**

* 1~5주차 내용을 진행했다면 현재 화면은 왼쪽 아래와 같은 화면일 것이고, 최종 개발을 완료하면 오른쪽 화면이 된다.
* 물론, 보안상 코드 전체를 공개하지는 않지만 "클론 코딩" 을 하고난 후 코드 해석 및 구조 정리를 하겠다.

<img src="..\images\2023-02-01-3주차\image-20230131173428552.png" alt="image-20230131173428552" style="zoom:80%;" /> <img src="..\images\2023-02-14-MY_MAIN_정리\image-20230214030006771.png" alt="image-20230214030006771" style="zoom:80%;" /> 

<br>

# Import & 변수 정리

**Import 몇개만 소개하겠다.**

* `useState, useEffect` 로 상태 변수들 관리
  * `AsyncStorage` 로 앱 내부 저장소 사용
  * `useRecoilState` 로 앱 실행 동안 상태 저장소 사용(상태 관리)
* `TouchableOpacity` 위젯으로 터치!
  * `react-native-dark-mode` 를 통해서 다크모드, 동적 스타일 시트 등등 사용
* `NetInfo` 네트워크 연결 관리
* 사용자 커스텀
  * `Loading, HTTP통신 관련 등등`



**변수 정리**

* functionOnOff 는 서버에서 관리 및 기능 접근 ON/OFF

  ​    functionSyncOnOff 는 서버에서 관리 및 동기화된 정보가 있다면, 기능 접근 OFF로 막아도 접근 가능하게 할 건지 여부

  ​    functionOnOffAndingArray 는 ON/OFF + 기능 숨김, 보이기 여부 

  1. loading(상단 부분 로딩 중인 경우)

  2. loginViewLoading(상단 부분 동기화 즉, 프로그래스바 진행 중인 경우) 

  3. !session(로그인이 안된 상태의 상단 부분 뷰)

     *   // 참고로 session 부분은 useRecoilState(loginSession) 를 통해서 초기값 등록(Recoil이용)

         // 그런데, Recoil은 앱 껏다키면 데이터 없어짐. 따라서 초기값은 당연히 null일 것임.

* **`functionSyncNumber` 변수이름으로 이미 동기화 된 기능들의 개수를 구한다.**

  * `functionSyncArray` 배열은 동기화 여부 T/F 로 기록되어 있고,
  * `exceptFunctionNameArray` 배열은 동기화를 할 필요가 없는 기능들이 담겨 있다.

* **`loadingProgress` 변수로 프로그래스 바 채워나감(0~1사이 값으로 적용 되어 있음)**

  * 계산식 예 : `setLoadingProgress(parseFloat(progressNumber++) / functionNumber)`
    * "현재 로딩완료한 함수 개수/전체 로딩할 함수 개수" 를 의미
      * `progressNumber` 초기값은 1이며, `functionNumber` 는 동기화 할 기능의 총 개수

* **`loadingProgressInfoString` 변수로 현재 진행상황을 문자열로 표시**

* usersStatusCheck

* 위 내용이 출력되며, `registerFunctionIndex` 변수는 미리 구해둔 학적부 기능 인덱스 저장용 변수

<br>

# MyLoginInfoView(상단 뷰)

**MY 화면에서 제일 상단 부분을 구성하는 커스텀 위젯이다.**

**< 해당 위젯의 전체적인 흐름 >**

* 초기 : 간단한 변수 선언
* 이후 : 조건문 5가지 경우로 나뉨
  1. loading(상단 부분 로딩 중인 경우)
  2. loginViewLoading(상단 부분 동기화 즉, 프로그래스바 진행 중인 경우) 
  3. !session(로그인이 안된 상태의 상단 부분 뷰)
  4. session(로그인이 된 상태의 상단 부분 뷰)
  5. else(에러)



**초기**

* **스타일은 `DynamicStyleSheet 와 다크모드` 를 사용한다.**

  * `useDynamicStyleSheet(위 스타일 변수)` 형태로 사용
  * `useDarkMode()` 형태로 사용해서 다크모드 상태인지 T/F 반환 받아서 활용
* **`functionSyncNumber` 변수이름으로 이미 동기화 된 기능들의 개수를 구한다.**
  * 계산식 : `(functionSyncArray.slice(1).filter(Boolean).length) - 	(exceptFunctionNameArray.length)`
    * `functionSyncArray` 배열은 동기화 여부 T/F 로 기록되어 있고,
    * `exceptFunctionNameArray` 배열은 동기화를 할 필요가 없는 기능들이 담겨 있다.



**loading(상단 부분 로딩 중인 경우)** 

* **`loading.js` 파일에서 따로 Loading 컴포넌트를 구현해놓았고 이를 출력**
* **참고로 `handleLoading(T/F)` 함수로 `loading` 값 변경하며 자세한건 코드 직접 확인(조금 복잡)**



**loginViewLoading(상단 부분 동기화 즉, 프로그래스바 진행 중인 경우)** 

* **`loadingProgress` 변수로 프로그래스 바 채워나감(0~1사이 값으로 적용 되어 있음)**
  * 계산식 예 : `setLoadingProgress(parseFloat(progressNumber++) / functionNumber)`
    * "현재 로딩완료한 함수 개수/전체 로딩할 함수 개수" 를 의미
      * `progressNumber` 초기값은 1이며, `functionNumber` 는 동기화 할 기능의 총 개수
* **`loadingProgressInfoString` 변수로 현재 진행상황을 문자열로 표시**
  * 첫번째 부터 세번째 까지 진행상황이 존재(동기화 함수 내에서만 존재)
    * 첫번째 : `setLoadingProgressInfoString("로그인 정보를 확인하고 있습니다.")`
    * 두번째 : `setLoadingProgressInfoString("동기화를 준비중입니다.")`
    * 세번째 : `setLoadingProgressInfoString(functionKoreanNameArray[idx] + " 데이터를 동기화하였습니다.")`



**!session(로그인이 안된 상태의 상단 부분 뷰)**

* **`functionOnOffAndingArray[0]` 은 로그인 기능 순번이며, 기능 접근 ON/OFF + 기능 숨김 or 보이기 여부를 의미**
  * `false` 이면 학생정보 기능은 점검중이라는 메시지를 상단 뷰에 출력할 것이다.
    * 왜냐하면 서버에서 기능 접근 못하게 하는 상황 + 기능 숨김 상태라서!!
    * 사실 여기선 기능 숨김 여부는 필요없어 보인다. 점검중인지만 알면 된다고 생각한다.
* **`functionOnOffAndingArray[0]` 은 학생정보 점검중 표시 뿐만 아니라, 로그인 메시지와 버튼 출력에도 사용**
  * `true` 이면 기능 접근 ON, 기능 보이는 상태니까 로그인이 필요하다고 텍스트 & 버튼 출력
    * 왜냐하면 로그인이 안된 상태니까
    * 또한, 버튼은 `usersStatusCheck` 변수를 사용해서 네트워크 상태를 체크해서 맞으면 버튼 출력한다.
      * `usersStatusCheck` 변수는 `NetInfo` 라이브러리를 활용해서 선언한 상태 변수이다.

* **참고**
  * **`session` 은 `useRecoilState(loginSession)` 를 통해서 초기값 등록(Recoil이용)**
    * 그런데, Recoil은 앱 껏다키면 데이터 없어짐. 따라서 초기값은 당연히 null
  * **그럼 이 session이 값을 가지는 경우들은??**
    1. 직접 로그인을 해서 session값을 담거나,
    2. MY탭 오픈 때 AsyncStorage에 로그인 기록 있으면 session값을 담는다.



**session(로그인이 된 상태의 상단 부분 뷰)**

* **이부분은 기능개발 이후에 정상 동작!! (기능 개발을 해야 선언되는 변수들이 있어서!)**

* **`inspectFunctionArray` 변수를 선언해서 기능 점검중인 함수들을 모아 표시해줄 것이다.**

  * `(!functionOnOffAndingArray[0] || inspectFunctionArrayLength > 0) && (<View...`
    * 로그인 기능이 점검 & 숨긴 상태이거나, 점검중인 기능들이 존재한다면? 아래 코드 진행
  * `(!functionOnOffAndingArray[0] ? "학생정보" : inspectFunctionArray) + " 기능이 점검중입니다." + (functionSyncNumber > 0 ? "\n(동기화 된 정보만 조회 가능)" : "")`
    * 로그인 기능 점검 & 점검중인 함수들 여럿있고 & 동기화된 기능이 몇개 있다면?
    * 출력문 : "학생정보 외박신청, 설정 외 기능이 점검중입니다.\n (동기화 된 정보만 조회 가능)" 

* **이 코드부분에서는 로그인 된 상태라고 했으니 session도 당연히 존재**

  * 따라서 `session.userInfoData(학생정보 관련 데이터)` 부분을 사용해서

    * 상단 뷰에 "디스이즈 로고, 학생 이름, 학번, 대학(학부), 학과(부)"를 표시한다.

  * 만약 `session.userInfoData` 데이터가 없다면???

    ```js
    {functionOnOffAndingArray[0] ? 
        functionOnOffAndingArray[registerFunctionIndex] ? 
        	"학적부 정보 동기화가 필요합니다." : 
    		"현재 학적부 기능이 점검중입니다." :
    	"현재 학생정보 기능이 점검중입니다."}
    ```

    * 위 내용이 출력되며, `registerFunctionIndex` 변수는 미리 구해둔 학적부 기능 인덱스 저장용 변수
    * 또한, 동기화 버튼은 그래도 표시한다.
      * 학적부가 점검중이래도 다른 기능들은 접근 가능한 상태일수도 있기 때문이다.

* **참고**
  * **`session` 은 `useRecoilState(loginSession)` 를 통해서 초기값 등록(Recoil이용)**
    * 그런데, Recoil은 앱 껏다키면 데이터 없어짐. 따라서 초기값은 당연히 null
  * **그럼 이 session이 값을 가지는 경우들은??**
    1. 직접 로그인을 해서 session값을 담거나,
    2. MY탭 오픈 때 AsyncStorage에 로그인 기록 있으면 session값을 담는다.



**else(에러)**

* **그 외의 경우는 고려하지 않으므로 이부분은 에러로 처리(상단부분 뷰)**



**상단 뷰를 개발하고 나면 아래와 같은 결과를 얻을 수 있다.**



<img src="..\images\2023-02-14-MY_MAIN_정리\image-20230215014902100.png" alt="image-20230215014902100" style="zoom:80%;" /> 

<br>

# FunctionListView(하단 뷰)

하단뷰 과정중에서 동기화 버튼의 위치 보여주려고 => 우선 아래그림의 위치엔 이제 없어?? 보인다.(마무리에 적어놨음)

<img src="..\images\2023-02-14-MY_MAIN_정리\image-20230215173010685.png" alt="image-20230215173010685" style="zoom:80%;" />   <img src="..\images\2023-02-14-MY_MAIN_정리\image-20230215174439496.png" alt="image-20230215174439496" style="zoom: 80%;" /> 

이건 뷰는 최종

이제 기능만..



<br>

# stuinfo_main(기능)











<br>

# 마무리

**2023-02-15 기준**

* **참고로 현재 최신 디스이즈 앱에서는 "설정" 에 현재 `외박신청, 성적입력조회` - 보이기, 숨기기 기능은 없음.**

* **또한, "동기화" 버튼은 로그인 하고나서 `상단 뷰에 전체 동기화`와 각각 기능들 접근해서 `내부에서 동기화 버튼`만 존재**

